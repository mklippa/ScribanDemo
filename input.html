<html>
    <head>
    </head>
    <body>
        {{
            items = []
            difficultyRegExPattern = `^DifficultyScale(\d+)$`
            discriminationRegExPattern = `^DifficultyScale(\d+)DI$`
            guessingRegExPattern = `^DifficultyScale(\d+)Guess$`
            curriculum = "Curriculum"
            for assessment in test_result
                for section in assessment.sections
                    for item in section.items
                        tags = []
                        curriculumTags = []
                        for metadata in item.question.metadatas
                            difficultyMatch = metadata.name | regex.match difficultyRegExPattern
                            discriminationMatch = metadata.name | regex.match discriminationRegExPattern
                            guessingMatch = metadata.name | regex.match guessingRegExPattern
                            if (difficultyMatch | array.size > 0)
                                tags = tags | array.add { id: difficultyMatch[1], name: "Difficulty", value: [metadata.value] }
                            else if (discriminationMatch | array.size > 0)
                                tags = tags | array.add { id: discriminationMatch[1], name: "Discrimination", value: metadata.value }
                            else if (guessingMatch | array.size > 0)
                                tags = tags | array.add { id: guessingMatch[1], name: "Guessing", value: metadata.value }
                            else if (metadata.name == curriculum)
                                curriculumTags = curriculumTags | array.add metadata.value
                            end
                        end
                        items = items | array.add { curriculumTags: curriculumTags, scaleData: tags }
                    end
                end
            end
            result = []
            for tags in items
                result[for.index] = { ID: for.index, CurriculumTags: tags.curriculumTags }
                scaleData = []
                for tag in tags.scaleData
                    existed = -1
                    for data in scaleData
                        if data.ID == tag.id
                            existed = for.index
                            break
                        end
                    end
                    if existed != -1
                        scaleData[existed][tag.name] = tag.value
                    else
                        data = { ID: tag.id }
                        data[tag.name] = tag.value
                        scaleData = scaleData | array.add data
                    end
                end
                result[for.index].ScaleData = scaleData
            end
        }}
        {{ for item in result }}
            <p>{{ item }}</p>
        {{ end }}
    </body>
</html>
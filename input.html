<html>
    <head>
    </head>
    <body>
        {{
            items = []
            difficultyRegExPattern = `^DifficultyScale(\d+)$`
            discriminationRegExPattern = `^DifficultyScale(\d+)DI$`
            guessingRegExPattern = `^DifficultyScale(\d+)Guess$`
            for assessment in test_result
                for section in assessment.sections
                    for item in section.items
                        tags = []
                        for metadata in item.question.metadatas
                            difficultyMatch = metadata.name | regex.match difficultyRegExPattern
                            discriminationMatch = metadata.name | regex.match discriminationRegExPattern
                            guessingMatch = metadata.name | regex.match guessingRegExPattern
                            if (difficultyMatch | array.size > 0)
                                tags = tags | array.add { id: difficultyMatch[1], name: "difficulty", value: metadata.value }
                            else if (discriminationMatch | array.size > 0)
                                tags = tags | array.add { id: discriminationMatch[1], name: "discrimination", value: metadata.value }
                            else if (guessingMatch | array.size > 0)
                                tags = tags | array.add { id: guessingMatch[1], name: "guessing", value: metadata.value }
                            end
                        end
                        items = items | array.add tags
                    end
                end
            end
            result = []
            for tags in items
                result[for.index] = { itemId: for.index }
                scaleData = []
                for tag in tags
                    existed = -1
                    for data in scaleData
                        if data.id == tag.id
                            existed = for.index
                            break
                        end
                    end
                    if existed != -1
                        scaleData[existed][tag.name] = tag.value
                    else
                        data = { id: tag.id }
                        data[tag.name] = tag.value
                        scaleData = scaleData | array.add data
                    end
                end
                result[for.index].scaleData = scaleData
            end
        }}
        {{ for item in result }}
            <h1>Item {{ item.itemId }}</h1>
            {{ for data in item.scaleData }}
                <h2>{{ data }}</h2>
            {{ end }}
        {{ end }}
    </body>
</html>
<html>
    <head>
    </head>
    <body>
        {{
            func get_report_input
                itemList = []
                sessionHistory = []
                curriculumTagName = "Curriculum Sub-Category"
                difficultyTagNamePattern = `^DifficultyScale(\S+)$`
                discriminationTagNamePattern = `^DifficultyScale(\S+)DI$`
                guessingTagNamePattern = `^DifficultyScale(\S+)Guess$`
                for assessment in test_result
                    for section in assessment.sections
                        for item in section.items
                            sessionHistory = sessionHistory | array.add { ID: item.question.item_id, AwardedMarks: item.mark }
                            scaleData = []
                            curriculumTags = []
                            for metadata in item.question.metadatas
                                difficultyMatches = metadata.name | regex.match difficultyTagNamePattern
                                discriminationMatches = metadata.name | regex.match discriminationTagNamePattern
                                guessingMatches = metadata.name | regex.match guessingTagNamePattern
                                if (discriminationMatches | array.size > 0)
                                    continue
                                else if (guessingMatches | array.size > 0)
                                    continue
                                else if (difficultyMatches | array.size > 0)
                                    scaleData = scaleData | array.add {
                                        ID: difficultyMatches[1],
                                        Difficulty: [metadata.value]
                                    }
                                else if (metadata.name == curriculumTagName)
                                    curriculumTags = curriculumTags | array.add metadata.value
                                end
                            end
                            itemList = itemList | array.add {
                                ID: item.question.item_id,
                                CurriculumTags: curriculumTags,
                                ScaleData: scaleData
                            }
                        end
                    end
                end
                curriculumTags = []
                for item in itemList
                    curriculumTags = curriculumTags | array.add_range item.CurriculumTags
                end
                curriculumTags = curriculumTags | array.uniq
                ret {
                    ItemList: itemList,
                    SessionHistory: sessionHistory,
                    ReportRequest: { CurriculumTags: curriculumTags }
                }
            end

            get_report_input
        }}
    </body>
</html>